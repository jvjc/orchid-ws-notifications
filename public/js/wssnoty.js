(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,c(o.key),o)}}function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function o(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,i=r(e);if(n){var c=r(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(this,o)}}function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}function i(t,e,n){return(e=c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,n||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===t(n)?n:String(n)}var a=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}(s,window.Controller);var r,i,c,a=o(s);function s(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),a.apply(this,arguments)}return r=s,i=[{key:"triggerEvent",value:function(t,e){var n=new CustomEvent(t,{detail:e});document.querySelector("body").dispatchEvent(n)}},{key:"showToast",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n='<div class="toast-header">\n            <strong class="me-auto">'.concat(e.title,"</strong>\n            ").concat(e.subtitle?"<small>"+e.subtitle+"</small>":"",'\n            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>\n        </div>'),o='<div class="toast-body">'.concat(e.message,"</div>"),r=document.createElement("div");if(r.setAttribute("class","toast m-3 ".concat({primary:"bg-primary text-white",secondary:"bg-secondary text-white",success:"bg-success text-white",danger:"bg-danger text-white",warning:"bg-warning text-white",info:"bg-info text-white",light:"bg-light text-dark",dark:"bg-dark text-white"}[e.theme])),r.classList.add(),r.setAttribute("role","alert"),r.setAttribute("aria-live","assertive"),r.setAttribute("aria-atomic","true"),r.innerHTML=n+o,e.buttons&&e.buttons.length>0){var i=document.createElement("div");i.setAttribute("class","mt-2 pt-2 border-top d-flex"),e.buttons.forEach((function(e){var n=document.createElement("button");n.setAttribute("type","button"),n.setAttribute("class","btn btn-".concat(e.theme," btn-sm me-1")),"link"===e.action?n.onclick=function(){window.location.href=e.url}:"event"===e.action&&(n.onclick=function(){t.triggerEvent(e.event,e.detail)}),n.textContent=e.text,i.append(n)})),r.querySelector(".toast-body").append(i)}document.querySelector(".toast-wrapper").append(r);var c=new Bootstrap.Toast(r,{autohide:e.autohide,delay:e.delay||5e3});r.addEventListener("hidden.bs.toast",(function(){r.remove()})),c.show()}},{key:"connect",value:function(){this.connectWebSocket(),this.startKeepAlive()}},{key:"disconnect",value:function(){this.stopKeepAlive(),this.disconnectWebSocket()}},{key:"connectWebSocket",value:function(){var t=this;this.websocket=new WebSocket(this.endpointValue),this.websocket.onmessage=function(e){try{var n=JSON.parse(e.data),o=n.type,r=n.payload;"notification"===o?t.showToast(r):"event"===o&&t.triggerEvent(r.event,r.detail)}catch(t){}},this.websocket.onclose=function(){t.reconnectWebSocket()}}},{key:"reconnectWebSocket",value:function(){var t=this;setTimeout((function(){t.connectWebSocket()}),5e3)}},{key:"disconnectWebSocket",value:function(){this.websocket&&this.websocket.close()}},{key:"startKeepAlive",value:function(){var t=this;this.keepAliveInterval=setInterval((function(){t.websocket.readyState===WebSocket.OPEN&&t.websocket.send("keep-alive")}),3e4)}},{key:"stopKeepAlive",value:function(){clearInterval(this.keepAliveInterval)}}],i&&e(r.prototype,i),c&&e(r,c),Object.defineProperty(r,"prototype",{writable:!1}),s}();i(a,"targets",["status"]),i(a,"values",{endpoint:String}),application.register("wssnoty",a)})();